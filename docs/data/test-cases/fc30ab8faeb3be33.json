{"uid":"fc30ab8faeb3be33","name":"test_role_addfail3","fullName":"Tests.test_system.test_role.TestRolePage#test_role_addfail3","historyId":"e1b6563296d078e42747b5e2c15d1cff","time":{"start":1769543163567,"stop":1769543163567,"duration":0},"status":"broken","statusMessage":"selenium.common.exceptions.TimeoutException: Message: 点击失败，找不到元素：xpath = (//span[text()=\"系统管理\"])[1]","statusTrace":"self = <Pages.itemsPage.login_page.LoginPage object at 0x000001EC043AA110>, by_or_element = 'xpath', value = '(//span[text()=\"系统管理\"])[1]', wait_time = 10, retries = 2\n\n    def click(self, by_or_element, value=None, wait_time=10, retries=2):\n        \"\"\"\n        更稳健的点击方法：支持定位符或 WebElement，自动处理 stale 元素、点击拦截等问题。\n        \"\"\"\n        for attempt in range(retries):\n            try:\n                if value is not None:\n                    by = by_or_element\n                    logging.info(f\"点击元素：By = {by}, Value = {value}\")\n>                   element = WebDriverWait(self.driver, wait_time).until(\n                        EC.element_to_be_clickable((by, value))\n                    )\n\nPages\\base_page.py:49: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <selenium.webdriver.support.wait.WebDriverWait (session=\"fb864850a1ecd3f683730509236dc41d\")>, method = <function element_to_be_clickable.<locals>._predicate at 0x000001EC04749750>, message = ''\n\n    def until(self, method: Callable[[D], Union[Literal[False], T]], message: str = \"\") -> T:\n        \"\"\"Wait until the method returns a value that is not False.\n    \n        Calls the method provided with the driver as an argument until the\n        return value does not evaluate to ``False``.\n    \n        Parameters:\n        -----------\n        method: callable(WebDriver)\n            - A callable object that takes a WebDriver instance as an argument.\n    \n        message: str\n            - Optional message for :exc:`TimeoutException`\n    \n        Return:\n        -------\n        object: T\n            - The result of the last call to `method`\n    \n        Raises:\n        -------\n        TimeoutException\n            - If 'method' does not return a truthy value within the WebDriverWait\n            object's timeout\n    \n        Example:\n        --------\n        >>> from selenium.webdriver.common.by import By\n        >>> from selenium.webdriver.support.ui import WebDriverWait\n        >>> from selenium.webdriver.support import expected_conditions as EC\n    \n        # Wait until an element is visible on the page\n        >>> wait = WebDriverWait(driver, 10)\n        >>> element = wait.until(EC.visibility_of_element_located((By.ID, \"exampleId\")))\n        >>> print(element.text)\n        \"\"\"\n        screen = None\n        stacktrace = None\n    \n        end_time = time.monotonic() + self._timeout\n        while True:\n            try:\n                value = method(self._driver)\n                if value:\n                    return value\n            except self._ignored_exceptions as exc:\n                screen = getattr(exc, \"screen\", None)\n                stacktrace = getattr(exc, \"stacktrace\", None)\n            if time.monotonic() > end_time:\n                break\n            time.sleep(self._poll)\n>       raise TimeoutException(message, screen, stacktrace)\nE       selenium.common.exceptions.TimeoutException: Message: \nE       Stacktrace:\nE       Symbols not available. Dumping unresolved backtrace:\nE       \t0x7ff7a57dfe35\nE       \t0x7ff7a57dfe90\nE       \t0x7ff7a556139d\nE       \t0x7ff7a55b9d8e\nE       \t0x7ff7a55ba09c\nE       \t0x7ff7a560e8d7\nE       \t0x7ff7a560b61b\nE       \t0x7ff7a55aac6d\nE       \t0x7ff7a55abae3\nE       \t0x7ff7a5aaa10d\nE       \t0x7ff7a5aa448a\nE       \t0x7ff7a5ac5157\nE       \t0x7ff7a57fa81e\nE       \t0x7ff7a580262f\nE       \t0x7ff7a57e9324\nE       \t0x7ff7a57e94df\nE       \t0x7ff7a57cee88\nE       \t0x7ffc59d27374\nE       \t0x7ffc5a9fcc91\n\nD:\\Python310\\lib\\site-packages\\selenium\\webdriver\\support\\wait.py:138: TimeoutException\n\nDuring handling of the above exception, another exception occurred:\n\n    @pytest.fixture(scope=\"module\")  # (scope=\"class\")这个参数表示整个测试类共用同一个浏览器，默认一个用例执行一次\n    def login_to_role():\n        driver = None\n        try:\n            \"\"\"初始化并返回 driver\"\"\"\n            date_driver = DateDriver()\n            driver = create_driver(date_driver.driver_path)\n            driver.implicitly_wait(3)\n    \n            # 初始化登录页面\n            page = LoginPage(driver)  # 初始化登录页面\n            url = date_driver.url\n            print(f\"[INFO] 正在导航到 URL: {url}\")\n            # 尝试访问 URL，捕获连接错误\n            for attempt in range(2):\n                try:\n                    page.navigate_to(url)\n                    break\n                except WebDriverException as e:\n                    capture_screenshot(driver, f\"login_fail_{attempt + 1}\")\n                    logging.warning(f\"第 {attempt + 1} 次连接失败: {e}\")\n                    driver.refresh()\n                    sleep(date_driver.URL_RETRY_WAIT)\n            else:\n                logging.error(\"连接失败多次，测试中止\")\n                safe_quit(driver)\n                raise RuntimeError(\"无法连接到登录页面\")\n    \n            page.login(date_driver.username, date_driver.password, date_driver.planning)\n            list_ = [\"系统管理\", \"系统设置\", \"角色管理\"]\n            for v in list_:\n>               page.click_button(f'(//span[text()=\"{v}\"])[1]')\n\nTests\\test_system\\test_role.py:54: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nPages\\itemsPage\\login_page.py:25: in click_button\n    self.click(By.XPATH, xpath)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <Pages.itemsPage.login_page.LoginPage object at 0x000001EC043AA110>, by_or_element = 'xpath', value = '(//span[text()=\"系统管理\"])[1]', wait_time = 10, retries = 2\n\n    def click(self, by_or_element, value=None, wait_time=10, retries=2):\n        \"\"\"\n        更稳健的点击方法：支持定位符或 WebElement，自动处理 stale 元素、点击拦截等问题。\n        \"\"\"\n        for attempt in range(retries):\n            try:\n                if value is not None:\n                    by = by_or_element\n                    logging.info(f\"点击元素：By = {by}, Value = {value}\")\n                    element = WebDriverWait(self.driver, wait_time).until(\n                        EC.element_to_be_clickable((by, value))\n                    )\n                else:\n                    logging.info(\"点击元素：WebElement 对象\")\n                    element = by_or_element\n    \n                element.click()\n                logging.info(\"✅ 点击成功\")\n                return\n    \n            except ElementClickInterceptedException:\n                logging.warning(\"⚠️ 原生点击被拦截，尝试使用 JS 点击\")\n                try:\n                    self.driver.execute_script(\"arguments[0].click();\", element)\n                    logging.info(\"✅ JS 点击成功\")\n                    return\n                except Exception as js_error:\n                    logging.warning(f\"⚠️ JS 点击失败：{js_error}\")\n                    sleep(1)\n                    continue  # 下一轮重试\n    \n            except StaleElementReferenceException:\n                logging.warning(f\"⚠️ 第 {attempt + 1} 次点击失败：元素过期，尝试重新定位\")\n                sleep(1)\n                continue  # 下一轮重试时重新定位\n    \n            except TimeoutException:\n                logging.error(f\"❌ 元素未在 {wait_time} 秒内变为可点击\")\n>               raise TimeoutException(f\"点击失败，找不到元素：{by_or_element} = {value}\")\nE               selenium.common.exceptions.TimeoutException: Message: 点击失败，找不到元素：xpath = (//span[text()=\"系统管理\"])[1]\n\nPages\\base_page.py:78: TimeoutException","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"login_to_role","time":{"start":1769543072458,"stop":1769543096165,"duration":23707},"status":"broken","statusMessage":"selenium.common.exceptions.TimeoutException: Message: 点击失败，找不到元素：xpath = //li[text()=\"金属（演示）\"]\n\n","statusTrace":"  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 38, in run_old_style_hookwrapper\n    res = yield\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    teardown.throw(exception)\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 53, in run_old_style_hookwrapper\n    return result.get_result()\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_result.py\", line 103, in get_result\n    raise exc.with_traceback(tb)\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 38, in run_old_style_hookwrapper\n    res = yield\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    teardown.throw(exception)\n  File \"D:\\Python310\\lib\\site-packages\\_pytest\\setuponly.py\", line 36, in pytest_fixture_setup\n    return (yield)\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 121, in _multicall\n    res = hook_impl.function(*args)\n  File \"D:\\Python310\\lib\\site-packages\\_pytest\\fixtures.py\", line 1195, in pytest_fixture_setup\n    result = call_fixture_func(fixturefunc, request, kwargs)\n  File \"D:\\Python310\\lib\\site-packages\\_pytest\\fixtures.py\", line 922, in call_fixture_func\n    fixture_result = next(generator)\n  File \"D:\\PycharmProjects\\APS\\Tests\\test_system\\test_role.py\", line 51, in login_to_role\n    page.login(date_driver.username, date_driver.password, date_driver.planning)\n  File \"D:\\PycharmProjects\\APS\\Pages\\itemsPage\\login_page.py\", line 41, in login\n    self.select_planning_unit(planning_unit)\n  File \"D:\\PycharmProjects\\APS\\Pages\\itemsPage\\login_page.py\", line 30, in select_planning_unit\n    self.click_button(f'//li[text()=\"{planning_unit}\"]')\n  File \"D:\\PycharmProjects\\APS\\Pages\\itemsPage\\login_page.py\", line 25, in click_button\n    self.click(By.XPATH, xpath)\n  File \"D:\\PycharmProjects\\APS\\Pages\\base_page.py\", line 78, in click\n    raise TimeoutException(f\"点击失败，找不到元素：{by_or_element} = {value}\")\n","steps":[],"attachments":[{"uid":"d1332c2b96ad82e5","name":"Tests_test_system_test_role.py_20260128_034454","source":"d1332c2b96ad82e5.png","type":"image/png","size":259061},{"uid":"4c759889ee54f153","name":"Tests_test_system_test_role.py_20260128_034454","source":"4c759889ee54f153.png","type":"image/png","size":19252},{"uid":"d1a2c3a15379037c","name":"Tests_test_system_test_role.py_20260128_034454","source":"d1a2c3a15379037c.png","type":"image/png","size":25727},{"uid":"de1c0d9362d50d41","name":"Tests_test_system_test_role.py_20260128_034454","source":"de1c0d9362d50d41.png","type":"image/png","size":19252},{"uid":"40054ab66a17e528","name":"Tests_test_system_test_role.py_20260128_034454","source":"40054ab66a17e528.png","type":"image/png","size":19252},{"uid":"bc2de3b6a98fc6e0","name":"Tests_test_system_test_role.py_20260128_034454","source":"bc2de3b6a98fc6e0.png","type":"image/png","size":25727},{"uid":"4b9708866e1eedfc","name":"Tests_test_system_test_role.py_20260128_034455","source":"4b9708866e1eedfc.png","type":"image/png","size":25727},{"uid":"7bb228a1ceb1570a","name":"Tests_test_system_test_role.py_20260128_034455","source":"7bb228a1ceb1570a.png","type":"image/png","size":19252},{"uid":"82116ab452ad8a05","name":"Tests_test_system_test_role.py_20260128_034455","source":"82116ab452ad8a05.png","type":"image/png","size":25727},{"uid":"5c9c71b011361330","name":"Tests_test_system_test_role.py_20260128_034455","source":"5c9c71b011361330.png","type":"image/png","size":25727},{"uid":"a1602eaf9747cbf4","name":"Tests_test_system_test_role.py_20260128_034455","source":"a1602eaf9747cbf4.png","type":"image/png","size":19252},{"uid":"7a7fa601c2157013","name":"Tests_test_system_test_role.py_20260128_034455","source":"7a7fa601c2157013.png","type":"image/png","size":25727},{"uid":"781c14447a24477a","name":"Tests_test_system_test_role.py_20260128_034455","source":"781c14447a24477a.png","type":"image/png","size":25727},{"uid":"75db5fc6a4f9ceea","name":"Tests_test_system_test_role.py_20260128_034455","source":"75db5fc6a4f9ceea.png","type":"image/png","size":25727},{"uid":"caf5c26334c320f9","name":"Tests_test_system_test_role.py_20260128_034455","source":"caf5c26334c320f9.png","type":"image/png","size":19252},{"uid":"deaa76030e6ba18f","name":"Tests_test_system_test_role.py_20260128_034455","source":"deaa76030e6ba18f.png","type":"image/png","size":25727},{"uid":"2f7378db3f3c2744","name":"Tests_test_system_test_role.py_20260128_034456","source":"2f7378db3f3c2744.png","type":"image/png","size":19252}],"parameters":[],"attachmentStep":false,"hasContent":true,"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":17},{"name":"login_to_role","time":{"start":1769543098008,"stop":1769543124000,"duration":25992},"status":"broken","statusMessage":"selenium.common.exceptions.TimeoutException: Message: 点击失败，找不到元素：xpath = //li[text()=\"金属（演示）\"]\n\n","statusTrace":"  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 38, in run_old_style_hookwrapper\n    res = yield\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    teardown.throw(exception)\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 53, in run_old_style_hookwrapper\n    return result.get_result()\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_result.py\", line 103, in get_result\n    raise exc.with_traceback(tb)\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 38, in run_old_style_hookwrapper\n    res = yield\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    teardown.throw(exception)\n  File \"D:\\Python310\\lib\\site-packages\\_pytest\\setuponly.py\", line 36, in pytest_fixture_setup\n    return (yield)\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 121, in _multicall\n    res = hook_impl.function(*args)\n  File \"D:\\Python310\\lib\\site-packages\\_pytest\\fixtures.py\", line 1195, in pytest_fixture_setup\n    result = call_fixture_func(fixturefunc, request, kwargs)\n  File \"D:\\Python310\\lib\\site-packages\\_pytest\\fixtures.py\", line 922, in call_fixture_func\n    fixture_result = next(generator)\n  File \"D:\\PycharmProjects\\APS\\Tests\\test_system\\test_role.py\", line 51, in login_to_role\n    page.login(date_driver.username, date_driver.password, date_driver.planning)\n  File \"D:\\PycharmProjects\\APS\\Pages\\itemsPage\\login_page.py\", line 41, in login\n    self.select_planning_unit(planning_unit)\n  File \"D:\\PycharmProjects\\APS\\Pages\\itemsPage\\login_page.py\", line 30, in select_planning_unit\n    self.click_button(f'//li[text()=\"{planning_unit}\"]')\n  File \"D:\\PycharmProjects\\APS\\Pages\\itemsPage\\login_page.py\", line 25, in click_button\n    self.click(By.XPATH, xpath)\n  File \"D:\\PycharmProjects\\APS\\Pages\\base_page.py\", line 78, in click\n    raise TimeoutException(f\"点击失败，找不到元素：{by_or_element} = {value}\")\n","steps":[],"attachments":[{"uid":"78d5b2af1cacdb04","name":"Tests_test_system_test_role.py_20260128_034522","source":"78d5b2af1cacdb04.png","type":"image/png","size":259061},{"uid":"7146f0630b0c387","name":"Tests_test_system_test_role.py_20260128_034522","source":"7146f0630b0c387.png","type":"image/png","size":19252},{"uid":"5d5f5a04a26ccf63","name":"Tests_test_system_test_role.py_20260128_034522","source":"5d5f5a04a26ccf63.png","type":"image/png","size":25727},{"uid":"176b26b6406268ca","name":"Tests_test_system_test_role.py_20260128_034522","source":"176b26b6406268ca.png","type":"image/png","size":19252},{"uid":"9af42d36350c0bc0","name":"Tests_test_system_test_role.py_20260128_034522","source":"9af42d36350c0bc0.png","type":"image/png","size":19252},{"uid":"2d145c3d16a5406f","name":"Tests_test_system_test_role.py_20260128_034522","source":"2d145c3d16a5406f.png","type":"image/png","size":25727},{"uid":"a94802473d2a274f","name":"Tests_test_system_test_role.py_20260128_034522","source":"a94802473d2a274f.png","type":"image/png","size":25727},{"uid":"8ec97b916de24913","name":"Tests_test_system_test_role.py_20260128_034522","source":"8ec97b916de24913.png","type":"image/png","size":19252},{"uid":"8520f5ba2f85cf70","name":"Tests_test_system_test_role.py_20260128_034523","source":"8520f5ba2f85cf70.png","type":"image/png","size":25727},{"uid":"8a778ba398b5a6d8","name":"Tests_test_system_test_role.py_20260128_034523","source":"8a778ba398b5a6d8.png","type":"image/png","size":25727},{"uid":"6f5f6190d7c3d7e0","name":"Tests_test_system_test_role.py_20260128_034523","source":"6f5f6190d7c3d7e0.png","type":"image/png","size":19252},{"uid":"77256b8ce239d6e9","name":"Tests_test_system_test_role.py_20260128_034523","source":"77256b8ce239d6e9.png","type":"image/png","size":25727},{"uid":"89e1edc5a8e7d695","name":"Tests_test_system_test_role.py_20260128_034523","source":"89e1edc5a8e7d695.png","type":"image/png","size":25727},{"uid":"6b4f3da416ec9207","name":"Tests_test_system_test_role.py_20260128_034523","source":"6b4f3da416ec9207.png","type":"image/png","size":25727},{"uid":"2aeb0ef206836a49","name":"Tests_test_system_test_role.py_20260128_034523","source":"2aeb0ef206836a49.png","type":"image/png","size":19252},{"uid":"5cfdec3420e0a497","name":"Tests_test_system_test_role.py_20260128_034523","source":"5cfdec3420e0a497.png","type":"image/png","size":25727},{"uid":"179ce2f520b95afd","name":"Tests_test_system_test_role.py_20260128_034523","source":"179ce2f520b95afd.png","type":"image/png","size":19252}],"parameters":[],"attachmentStep":false,"hasContent":true,"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":17},{"name":"login_to_role","time":{"start":1769543127643,"stop":1769543161712,"duration":34069},"status":"broken","statusMessage":"selenium.common.exceptions.TimeoutException: Message: 点击失败，找不到元素：xpath = (//span[text()=\"系统管理\"])[1]\n\n","statusTrace":"  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 38, in run_old_style_hookwrapper\n    res = yield\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    teardown.throw(exception)\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 53, in run_old_style_hookwrapper\n    return result.get_result()\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_result.py\", line 103, in get_result\n    raise exc.with_traceback(tb)\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 38, in run_old_style_hookwrapper\n    res = yield\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    teardown.throw(exception)\n  File \"D:\\Python310\\lib\\site-packages\\_pytest\\setuponly.py\", line 36, in pytest_fixture_setup\n    return (yield)\n  File \"D:\\Python310\\lib\\site-packages\\pluggy\\_callers.py\", line 121, in _multicall\n    res = hook_impl.function(*args)\n  File \"D:\\Python310\\lib\\site-packages\\_pytest\\fixtures.py\", line 1195, in pytest_fixture_setup\n    result = call_fixture_func(fixturefunc, request, kwargs)\n  File \"D:\\Python310\\lib\\site-packages\\_pytest\\fixtures.py\", line 922, in call_fixture_func\n    fixture_result = next(generator)\n  File \"D:\\PycharmProjects\\APS\\Tests\\test_system\\test_role.py\", line 54, in login_to_role\n    page.click_button(f'(//span[text()=\"{v}\"])[1]')\n  File \"D:\\PycharmProjects\\APS\\Pages\\itemsPage\\login_page.py\", line 25, in click_button\n    self.click(By.XPATH, xpath)\n  File \"D:\\PycharmProjects\\APS\\Pages\\base_page.py\", line 78, in click\n    raise TimeoutException(f\"点击失败，找不到元素：{by_or_element} = {value}\")\n","steps":[],"attachments":[{"uid":"1c6d38ba3b67d1cc","name":"Tests_test_system_test_role.py_20260128_034559","source":"1c6d38ba3b67d1cc.png","type":"image/png","size":257579},{"uid":"f076e5350532f0e0","name":"Tests_test_system_test_role.py_20260128_034559","source":"f076e5350532f0e0.png","type":"image/png","size":19252},{"uid":"3a3aab179a3641d4","name":"Tests_test_system_test_role.py_20260128_034600","source":"3a3aab179a3641d4.png","type":"image/png","size":25727},{"uid":"de3777907a662945","name":"Tests_test_system_test_role.py_20260128_034600","source":"de3777907a662945.png","type":"image/png","size":19252},{"uid":"616e0bf05de47a72","name":"Tests_test_system_test_role.py_20260128_034600","source":"616e0bf05de47a72.png","type":"image/png","size":19252},{"uid":"e2418e96a954f433","name":"Tests_test_system_test_role.py_20260128_034600","source":"e2418e96a954f433.png","type":"image/png","size":25727},{"uid":"31ce08ca6712abf1","name":"Tests_test_system_test_role.py_20260128_034600","source":"31ce08ca6712abf1.png","type":"image/png","size":25727},{"uid":"3e2d07b1c9422615","name":"Tests_test_system_test_role.py_20260128_034600","source":"3e2d07b1c9422615.png","type":"image/png","size":19252},{"uid":"7cbf671f80181e97","name":"Tests_test_system_test_role.py_20260128_034600","source":"7cbf671f80181e97.png","type":"image/png","size":25727},{"uid":"737502b05a87d885","name":"Tests_test_system_test_role.py_20260128_034600","source":"737502b05a87d885.png","type":"image/png","size":25727},{"uid":"28a259bb5501f72a","name":"Tests_test_system_test_role.py_20260128_034601","source":"28a259bb5501f72a.png","type":"image/png","size":19252},{"uid":"7e6206f361cca0aa","name":"Tests_test_system_test_role.py_20260128_034601","source":"7e6206f361cca0aa.png","type":"image/png","size":25727},{"uid":"29f009abffd75c0e","name":"Tests_test_system_test_role.py_20260128_034601","source":"29f009abffd75c0e.png","type":"image/png","size":25727},{"uid":"b3ca46c35ad76e66","name":"Tests_test_system_test_role.py_20260128_034601","source":"b3ca46c35ad76e66.png","type":"image/png","size":25727},{"uid":"462d4f504c050f04","name":"Tests_test_system_test_role.py_20260128_034601","source":"462d4f504c050f04.png","type":"image/png","size":19252},{"uid":"b32932d7307df5fd","name":"Tests_test_system_test_role.py_20260128_034601","source":"b32932d7307df5fd.png","type":"image/png","size":25727},{"uid":"38f206d78d72d215","name":"Tests_test_system_test_role.py_20260128_034601","source":"38f206d78d72d215.png","type":"image/png","size":19252}],"parameters":[],"attachmentStep":false,"hasContent":true,"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":17},{"name":"login_to_role","time":{"start":1769543165372,"stop":1769543179155,"duration":13783},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentStep":false,"hasContent":false,"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0}],"testStage":{"status":"broken","statusMessage":"selenium.common.exceptions.TimeoutException: Message: 点击失败，找不到元素：xpath = (//span[text()=\"系统管理\"])[1]","statusTrace":"self = <Pages.itemsPage.login_page.LoginPage object at 0x000001EC043AA110>, by_or_element = 'xpath', value = '(//span[text()=\"系统管理\"])[1]', wait_time = 10, retries = 2\n\n    def click(self, by_or_element, value=None, wait_time=10, retries=2):\n        \"\"\"\n        更稳健的点击方法：支持定位符或 WebElement，自动处理 stale 元素、点击拦截等问题。\n        \"\"\"\n        for attempt in range(retries):\n            try:\n                if value is not None:\n                    by = by_or_element\n                    logging.info(f\"点击元素：By = {by}, Value = {value}\")\n>                   element = WebDriverWait(self.driver, wait_time).until(\n                        EC.element_to_be_clickable((by, value))\n                    )\n\nPages\\base_page.py:49: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <selenium.webdriver.support.wait.WebDriverWait (session=\"fb864850a1ecd3f683730509236dc41d\")>, method = <function element_to_be_clickable.<locals>._predicate at 0x000001EC04749750>, message = ''\n\n    def until(self, method: Callable[[D], Union[Literal[False], T]], message: str = \"\") -> T:\n        \"\"\"Wait until the method returns a value that is not False.\n    \n        Calls the method provided with the driver as an argument until the\n        return value does not evaluate to ``False``.\n    \n        Parameters:\n        -----------\n        method: callable(WebDriver)\n            - A callable object that takes a WebDriver instance as an argument.\n    \n        message: str\n            - Optional message for :exc:`TimeoutException`\n    \n        Return:\n        -------\n        object: T\n            - The result of the last call to `method`\n    \n        Raises:\n        -------\n        TimeoutException\n            - If 'method' does not return a truthy value within the WebDriverWait\n            object's timeout\n    \n        Example:\n        --------\n        >>> from selenium.webdriver.common.by import By\n        >>> from selenium.webdriver.support.ui import WebDriverWait\n        >>> from selenium.webdriver.support import expected_conditions as EC\n    \n        # Wait until an element is visible on the page\n        >>> wait = WebDriverWait(driver, 10)\n        >>> element = wait.until(EC.visibility_of_element_located((By.ID, \"exampleId\")))\n        >>> print(element.text)\n        \"\"\"\n        screen = None\n        stacktrace = None\n    \n        end_time = time.monotonic() + self._timeout\n        while True:\n            try:\n                value = method(self._driver)\n                if value:\n                    return value\n            except self._ignored_exceptions as exc:\n                screen = getattr(exc, \"screen\", None)\n                stacktrace = getattr(exc, \"stacktrace\", None)\n            if time.monotonic() > end_time:\n                break\n            time.sleep(self._poll)\n>       raise TimeoutException(message, screen, stacktrace)\nE       selenium.common.exceptions.TimeoutException: Message: \nE       Stacktrace:\nE       Symbols not available. Dumping unresolved backtrace:\nE       \t0x7ff7a57dfe35\nE       \t0x7ff7a57dfe90\nE       \t0x7ff7a556139d\nE       \t0x7ff7a55b9d8e\nE       \t0x7ff7a55ba09c\nE       \t0x7ff7a560e8d7\nE       \t0x7ff7a560b61b\nE       \t0x7ff7a55aac6d\nE       \t0x7ff7a55abae3\nE       \t0x7ff7a5aaa10d\nE       \t0x7ff7a5aa448a\nE       \t0x7ff7a5ac5157\nE       \t0x7ff7a57fa81e\nE       \t0x7ff7a580262f\nE       \t0x7ff7a57e9324\nE       \t0x7ff7a57e94df\nE       \t0x7ff7a57cee88\nE       \t0x7ffc59d27374\nE       \t0x7ffc5a9fcc91\n\nD:\\Python310\\lib\\site-packages\\selenium\\webdriver\\support\\wait.py:138: TimeoutException\n\nDuring handling of the above exception, another exception occurred:\n\n    @pytest.fixture(scope=\"module\")  # (scope=\"class\")这个参数表示整个测试类共用同一个浏览器，默认一个用例执行一次\n    def login_to_role():\n        driver = None\n        try:\n            \"\"\"初始化并返回 driver\"\"\"\n            date_driver = DateDriver()\n            driver = create_driver(date_driver.driver_path)\n            driver.implicitly_wait(3)\n    \n            # 初始化登录页面\n            page = LoginPage(driver)  # 初始化登录页面\n            url = date_driver.url\n            print(f\"[INFO] 正在导航到 URL: {url}\")\n            # 尝试访问 URL，捕获连接错误\n            for attempt in range(2):\n                try:\n                    page.navigate_to(url)\n                    break\n                except WebDriverException as e:\n                    capture_screenshot(driver, f\"login_fail_{attempt + 1}\")\n                    logging.warning(f\"第 {attempt + 1} 次连接失败: {e}\")\n                    driver.refresh()\n                    sleep(date_driver.URL_RETRY_WAIT)\n            else:\n                logging.error(\"连接失败多次，测试中止\")\n                safe_quit(driver)\n                raise RuntimeError(\"无法连接到登录页面\")\n    \n            page.login(date_driver.username, date_driver.password, date_driver.planning)\n            list_ = [\"系统管理\", \"系统设置\", \"角色管理\"]\n            for v in list_:\n>               page.click_button(f'(//span[text()=\"{v}\"])[1]')\n\nTests\\test_system\\test_role.py:54: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nPages\\itemsPage\\login_page.py:25: in click_button\n    self.click(By.XPATH, xpath)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <Pages.itemsPage.login_page.LoginPage object at 0x000001EC043AA110>, by_or_element = 'xpath', value = '(//span[text()=\"系统管理\"])[1]', wait_time = 10, retries = 2\n\n    def click(self, by_or_element, value=None, wait_time=10, retries=2):\n        \"\"\"\n        更稳健的点击方法：支持定位符或 WebElement，自动处理 stale 元素、点击拦截等问题。\n        \"\"\"\n        for attempt in range(retries):\n            try:\n                if value is not None:\n                    by = by_or_element\n                    logging.info(f\"点击元素：By = {by}, Value = {value}\")\n                    element = WebDriverWait(self.driver, wait_time).until(\n                        EC.element_to_be_clickable((by, value))\n                    )\n                else:\n                    logging.info(\"点击元素：WebElement 对象\")\n                    element = by_or_element\n    \n                element.click()\n                logging.info(\"✅ 点击成功\")\n                return\n    \n            except ElementClickInterceptedException:\n                logging.warning(\"⚠️ 原生点击被拦截，尝试使用 JS 点击\")\n                try:\n                    self.driver.execute_script(\"arguments[0].click();\", element)\n                    logging.info(\"✅ JS 点击成功\")\n                    return\n                except Exception as js_error:\n                    logging.warning(f\"⚠️ JS 点击失败：{js_error}\")\n                    sleep(1)\n                    continue  # 下一轮重试\n    \n            except StaleElementReferenceException:\n                logging.warning(f\"⚠️ 第 {attempt + 1} 次点击失败：元素过期，尝试重新定位\")\n                sleep(1)\n                continue  # 下一轮重试时重新定位\n    \n            except TimeoutException:\n                logging.error(f\"❌ 元素未在 {wait_time} 秒内变为可点击\")\n>               raise TimeoutException(f\"点击失败，找不到元素：{by_or_element} = {value}\")\nE               selenium.common.exceptions.TimeoutException: Message: 点击失败，找不到元素：xpath = (//span[text()=\"系统管理\"])[1]\n\nPages\\base_page.py:78: TimeoutException","steps":[],"attachments":[{"uid":"d96f850f60fc8399","name":"test_role_addfail3_20260128_034603","source":"d96f850f60fc8399.png","type":"image/png","size":259924},{"uid":"4dd024c3485a5a5e","name":"test_role_addfail3_20260128_034603","source":"4dd024c3485a5a5e.png","type":"image/png","size":19252},{"uid":"3804fb5acd4694c","name":"test_role_addfail3_20260128_034603","source":"3804fb5acd4694c.png","type":"image/png","size":25727},{"uid":"876d2d5cf10823b8","name":"test_role_addfail3_20260128_034603","source":"876d2d5cf10823b8.png","type":"image/png","size":19252},{"uid":"65de9a3715699334","name":"test_role_addfail3_20260128_034604","source":"65de9a3715699334.png","type":"image/png","size":19252},{"uid":"10c2ded75c0bc5e8","name":"test_role_addfail3_20260128_034604","source":"10c2ded75c0bc5e8.png","type":"image/png","size":25727},{"uid":"3d093d41289d823e","name":"test_role_addfail3_20260128_034604","source":"3d093d41289d823e.png","type":"image/png","size":25727},{"uid":"c2d8164030a1ad8c","name":"test_role_addfail3_20260128_034604","source":"c2d8164030a1ad8c.png","type":"image/png","size":19252},{"uid":"b48b66eb994af9a2","name":"test_role_addfail3_20260128_034604","source":"b48b66eb994af9a2.png","type":"image/png","size":25727},{"uid":"63af08ef7c131bf8","name":"test_role_addfail3_20260128_034604","source":"63af08ef7c131bf8.png","type":"image/png","size":25727},{"uid":"50e46d9628f6ee2b","name":"test_role_addfail3_20260128_034604","source":"50e46d9628f6ee2b.png","type":"image/png","size":19252},{"uid":"b3139c8b1aa5e5d8","name":"test_role_addfail3_20260128_034604","source":"b3139c8b1aa5e5d8.png","type":"image/png","size":25727},{"uid":"c5fa522c256f4632","name":"test_role_addfail3_20260128_034604","source":"c5fa522c256f4632.png","type":"image/png","size":25727},{"uid":"adff57eb5f62f081","name":"test_role_addfail3_20260128_034604","source":"adff57eb5f62f081.png","type":"image/png","size":25727},{"uid":"2933e01ef1f3b122","name":"test_role_addfail3_20260128_034605","source":"2933e01ef1f3b122.png","type":"image/png","size":19252},{"uid":"4bbfa06058727ad1","name":"test_role_addfail3_20260128_034605","source":"4bbfa06058727ad1.png","type":"image/png","size":25727},{"uid":"117a085dbfe8dfc9","name":"test_role_addfail3_20260128_034605","source":"117a085dbfe8dfc9.png","type":"image/png","size":19252}],"parameters":[],"attachmentStep":false,"hasContent":true,"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":17},"afterStages":[{"name":"login_to_role::0","time":{"start":1769543919295,"stop":1769543921533,"duration":2238},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentStep":false,"hasContent":false,"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0}],"labels":[{"name":"feature","value":"角色管理页用例"},{"name":"story","value":"点击输入角色代码和名称点击保存，不允许保存"},{"name":"parentSuite","value":"Tests.test_system"},{"name":"suite","value":"test_role"},{"name":"subSuite","value":"TestRolePage"},{"name":"host","value":"DESKTOP-L7L44NB"},{"name":"thread","value":"15128-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"Tests.test_system.test_role"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":true,"retry":true,"extra":{"categories":[],"tags":[]},"source":"fc30ab8faeb3be33.json","parameterValues":[]}